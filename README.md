# cute-bot

Бот для канала с картинками, который:

- Работает как предложка для всех пользователей
- Имеет специальный админ-канал, через который можно управлять предложкой (одобрять/отклонять картинки, видеть отправителя, банить и разбанивать отправителей), и управлять очередью постинга одобренного контента (планировать время постинга, менять очерёдность, группировать, flushить немедленно)

## Взаимодействие с обычным пользователем

При запуске отправляет приветствие с описанием. Если пользователь в бане, то не доброе приветствие.

Пользователь может отправить команду /help, на которую бот ответит описанием с помощью, или, если забанен, то с сообщением, что он забанен и что может теоретически сделать, чтобы быть разбаненным.

Если забаненный отправляет какой-либо контент, бот отвечает игнорирующим стикером (или несколькими, из набора).

Если обычный отправляет что-то без картинки, то бот отвечает, что он смотрит только на картиночки в сообщении, а ни одной нет, так что ничего не делает.

При получении одной и более картинок отвечает пользователю спасибо, а сам пересылает это всё в "предложенные".

**Дополнительно**: пользователь может попросить бота уведомить его, когда его картинки постятся. Может попросить отключить этот функционал.

**Вопрос**: Стоит ли уведомлять пользователя, если его картинка не прошла модерацию? Если стоит, то надо ли давать возможность модерам давать какое-то объяснение отказа? Сделать опциональной возможностью?

**Вопрос**: подумал о возможности некоторых пользователей помечать, как "априори расово верных", т.е. их контент будет автоматически помечаться как отмедированный и будет просто ставиться в очередь постинга. Но надо ли?

## Взаимодействие с админ-каналом

**Мысли**. Бот не будет различать как-либо разных участников. Сообщения от любых пользователей будут восприниматься в едином потоке. А вообще... это не очень вроде как разумный подход - ведь это лишает возможности параллельно разгребать предложку. С другой стороны... а зачем это делать параллельно? Выходной канал для постинга один, очереди одни - так что пусть они управляются из единого места открыто для всех.

В момент получения новой картинки от незабаненного пользователя она сразу направляется в админ-канал. (отправляются всегда строго по одной, даже если пользователь отправил альбом). К сообщению с картинкой прикрепляется несколько действий:

- В очередь постинга

Также в сообщении пишется id пользователя и известная мета о нём (никнейм, ссылка на него).

Можно ответить на сообщение какой-то особой командой, вроде:

```
/exec user-ban
/exec user-unban
/exec user-
```

При нажатии на аппрув, картинка ставится в очередь постинга.

## Структуры данных в БД

**UsersMeta** - таблица с последней известную мета-информацию о пользователях, то, что приходит в поле `from`. Привязана к айдишнику и нужно просто для того, чтобы бот мог отображать инфу о пользователях для модераторов или при постинге.

Поля:

- `id` int
- `is_bot` bool
- `first_name` string
- `last_name` string (optional)
- `username` string (optional)
- `language_code` string (optional)

**BannedUsers** - здесь просто список из айдишников тех, кто забанен.

Поля:

- `id` int

**Proposals** - здесь хранится список предложенных к постингу картинок

Поля:

- `user_id` int - кто предложил
- `file_id` int
- `type` "photo" | "video" | "document" - от этого поля зависит, каким методом отправлять - sendPhoto, sendVideo или sendDocument
- `approved` bool

**Scheduling** - единичная запись с конфигом для расписания.

Поля:

- `cron` - расписание постинга, расписанное в синтаксисе крона.
- `flush` - режим постинга в момента расписания. Синтаксис:
    - `\d+` - число, сколько за раз постить картинок
    - `\d+-\d+` - диапазон, сколько постить. Второе число должно быть не меньше первого

## Persistent

В нём хранятся все данные, которые как-либо нужно сохранять боту для работы.

